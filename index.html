<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ§åœºå¤§å¸ˆï¼šåŒ–è§£è¯¾å ‚å±æœº V17</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --panel-bg: rgba(30, 41, 59, 0.7);
            --text-main: #f1f5f9;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-gold: #f59e0b;
            --accent-purple: #8b5cf6;
        }
        body, html {
            margin: 0;
            padding: 0; height: 100%;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-dark); color: var(--text-main);
            overflow-x: hidden;
            /* é˜²æ­¢æ¨ªå‘æ»šåŠ¨ */
        }
        
        /* ä¿®å¤UIæ˜¾ç¤ºä¸å…¨ï¼šä¿®æ”¹Overlayå¸ƒå±€æ–¹å¼ */
        .overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            /* æ”¹ä¸º flex-start é˜²æ­¢é¡¶éƒ¨è¢«åˆ‡ */
            justify-content: flex-start;
            /* é¡¶éƒ¨å¯¹é½ */
            z-index: 2000;
            padding: 40px 20px;
            /* å¢åŠ ä¸Šä¸‹padding */
            overflow-y: auto;
            /* å…è®¸æ»šåŠ¨ */
        }

        /* æ¸¸æˆç•Œé¢å¸ƒå±€ */
        #game-interface { 
            min-height: 100vh;
            width: 100vw; display: flex; flex-direction: row; 
            flex-wrap: wrap;
            box-sizing: border-box;
        }
        #main-view { 
            flex: 3;
            display: flex; flex-direction: column; padding: 40px; position: relative;
            overflow: visible;
            /* å…è®¸å†…å®¹æ’‘å¼€ */
            min-width: 320px;
            box-sizing: border-box;
        }
        .chapter-banner {
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            text-align: center;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        #level-indicator { 
            font-size: 14px;
            color: var(--accent-gold); letter-spacing: 2px; margin-bottom: 10px; 
        }
        #scene-title { 
            font-size: 32px;
            margin-bottom: 20px;
            font-weight: bold; color: var(--accent-gold); 
        }
        #visual-canvas {
            flex-grow: 1;
            background: #1e293b; border-radius: 20px;
            display: flex; justify-content: flex-start; align-items: flex-start;
            position: relative; 
            padding: 30px 40px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 200px;
            box-sizing: border-box;
        }
        #student-dialog { 
            font-size: 20px;
            line-height: 2; color: #cbd5e1; 
            width: 100%; 
            white-space: normal; 
            word-wrap: break-word;
        }
        /* é€‰é¡¹æŒ‰é’® */
        #action-area { 
            min-height: 300px;
            display: flex; 
            flex-direction: column; 
            justify-content: flex-start; 
            gap: 15px; 
            margin-top: 20px;
            padding-bottom: 20px;
            box-sizing: border-box;
        }
        .choice-btn {
            background: var(--panel-bg);
            border: 2px solid rgba(255,255,255,0.1);
            color: white; padding: 20px 25px;
            border-radius: 15px;
            text-align: left; cursor: pointer; transition: all 0.3s; font-size: 17px;
            position: relative;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
            white-space: normal;
            word-wrap: break-word;
        }
        .choice-btn::before {
            content: "";
            position: absolute;
            left: 0; top: 0;
            width: 4px; height: 100%;
            background: var(--accent-blue);
            transition: width 0.3s;
        }
        .choice-btn:hover:not(:disabled) {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(8px);
            border-color: var(--accent-blue);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
        }
        .choice-btn:hover:not(:disabled)::before { width: 8px;
        }
        .choice-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed; filter: grayscale(1);
        }
        
        /* ä¾§è¾¹æ  */
        #status-sidebar {
            flex: 1;
            background: rgba(0,0,0,0.4); padding: 30px;
            display: flex; flex-direction: column; gap: 25px;
            border-left: 1px solid rgba(255,255,255,0.1);
            min-width: 280px;
            box-sizing: border-box;
        }
        .status-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .status-header i { font-size: 24px;
            color: var(--accent-gold); }
        .status-header h3 { margin: 0; color: var(--accent-gold); font-size: 20px;
        }
        .status-item {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .status-label {
            font-size: 16px;
            color: #94a3b8;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status-label span { color: var(--text-main); font-weight: bold;
        }
        .progress-bg {
            width: 100%;
            height: 12px;
            background: #334155;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }
        .progress-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        .respect-fill { background: var(--accent-green);
        }
        .control-fill { background: var(--accent-blue);
        }
        .status-tip {
            font-size: 12px;
            color: #64748b;
            margin-top: 8px;
            text-align: right;
        }

        /* è§„åˆ™å¡ç‰‡ */
        .rule-card {
            background: #1e293b;
            padding: 40px;
            border-radius: 20px;
            max-width: 800px;
            width: 100%; /* ç¡®ä¿åœ¨ç§»åŠ¨ç«¯ä¹Ÿèƒ½æ’‘å¼€ */
            line-height: 1.8;
            border: 2px solid var(--accent-purple);
            box-shadow: 0 0 50px rgba(139, 92, 246, 0.2);
            box-sizing: border-box;
            margin-bottom: 40px;
            /* åº•éƒ¨ç•™ç™½ */
        }
        .rule-card h2 {
            color: var(--accent-green);
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .rule-card h2 i { font-size: 36px;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 15px;
            color: #cbd5e1;
        }
        th, td {
            border: 1px solid rgba(255,255,255,0.1);
            padding: 12px;
            text-align: left;
        }
        th {
            background: rgba(245,158,11,0.1);
            color: var(--accent-gold);
            font-size: 16px;
        }

        /* æ¸¸æˆç»“æŸé¡µ */
        .end-card {
            text-align: center;
            padding: 60px 40px;
            background: #1e293b;
            border-radius: 25px;
            border: 2px solid var(--accent-gold);
            box-shadow: 0 0 50px rgba(245,158,11,0.2);
            max-width: 800px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 40px;
        }
        .end-rank {
            font-size: 64px;
            font-weight: bold;
            color: var(--accent-gold);
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(245,158,11,0.4);
        }
        .end-desc {
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
        }
        .stats-grid {
            display: flex;
            gap: 40px;
            justify-content: center;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        .stat-item {
            text-align: center;
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 15px;
            min-width: 150px;
            border: 1px solid rgba(255,255,255,0.08);
            box-sizing: border-box;
        }
        .stat-value {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .stat-label {
            font-size: 16px;
            color: #94a3b8;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-primary {
            background: linear-gradient(90deg, var(--accent-green), #059669);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            box-sizing: border-box;
        }
        .btn-primary:hover {
            background: linear-gradient(90deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        /* ç¯‡ç« è¿‡æ¸¡é¡µ */
        .chapter-transition {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 40px;
            overflow-y: auto;
        }
        .chapter-transition h2 {
            font-size: 48px;
            color: var(--accent-purple);
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }
        .chapter-transition p {
            font-size: 22px;
            margin-bottom: 40px;
            max-width: 600px;
            line-height: 1.8;
        }

        /* ç¯‡ç« æ€»ç»“é¡µ */
        .chapter-summary {
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            z-index: 4000;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            flex-direction: column;
            padding: 40px 20px;
            overflow-y: auto;
        }
        .summary-card {
            background: #1e293b;
            border: 2px solid var(--accent-red);
            border-radius: 20px;
            padding: 50px;
            max-width: 700px;
            width: 100%;
            box-shadow: 0 0 50px rgba(239, 68, 68, 0.2);
            box-sizing: border-box;
            margin-bottom: 40px;
        }
        .summary-card h2 {
            color: var(--accent-red);
            text-align: center;
            font-size: 32px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .summary-card .error-list {
            background: rgba(239, 68, 68, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
            border-left: 4px solid var(--accent-red);
        }
        .summary-card .error-list h4 {
            color: var(--accent-red);
            margin-top: 0;
            font-size: 19px;
        }
        .summary-card .error-list ul {
            margin: 10px 0;
            padding-left: 25px;
            line-height: 2;
        }
        .summary-card .retry-btn {
            background: linear-gradient(90deg, var(--accent-red), #dc2626);
            border: none;
            color: white;
            padding: 18px 40px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 30px auto 0;
            display: block;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            box-sizing: border-box;
        }
        .summary-card .retry-btn:hover {
            background: linear-gradient(90deg, #dc2626, #b91c1c);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        /* ç­”æ¡ˆåé¦ˆå¼¹çª—æ ·å¼ */
        #answer-feedback {
            z-index: 5000;
            display: none;
        }
        .feedback-card {
            background: #1e293b;
            border-radius: 20px;
            padding: 50px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 0 50px rgba(139, 92, 246, 0.3);
            border: 2px solid var(--accent-purple);
            box-sizing: border-box;
            margin-bottom: 40px;
        }
        .feedback-title {
            font-size: 32px;
            color: var(--accent-gold);
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .feedback-error {
            background: rgba(239, 68, 68, 0.1);
            border-left: 6px solid var(--accent-red);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            font-size: 18px;
            line-height: 2;
        }
        .feedback-error strong { color: var(--accent-red);
        }
        .feedback-correct {
            background: rgba(16, 185, 129, 0.1);
            border-left: 6px solid var(--accent-green);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            font-size: 18px;
            line-height: 2;
        }
        .feedback-correct strong { color: var(--accent-green);
        }
        .feedback-principle {
            background: rgba(139, 92, 246, 0.1);
            border-left: 6px solid var(--accent-purple);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            font-size: 18px;
            line-height: 2;
        }
        .feedback-principle strong { color: var(--accent-purple);
        }
        
        /* å€’è®¡æ—¶æŒ‰é’®æ ·å¼ */
        .feedback-next-btn {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            border: none;
            color: white;
            padding: 18px 40px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 30px auto 0;
            display: block;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .feedback-next-btn:hover:not(:disabled) {
            background: linear-gradient(90deg, #2563eb, #7c3aed);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        .feedback-next-btn:disabled {
            background: #475569;
            cursor: wait;
            transform: none;
            box-shadow: none;
            opacity: 0.8;
        }

        /* æœ€ç»ˆæ€»ç»“å¼¹çª—æ ·å¼ */
        #final-summary {
            z-index: 6000;
            display: none;
        }
        .success-card {
            border-color: var(--accent-green);
            box-shadow: 0 0 50px rgba(16, 185, 129, 0.3);
        }
        .fail-card {
            border-color: var(--accent-red);
            box-shadow: 0 0 50px rgba(239, 68, 68, 0.3);
        }
        .final-title {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        .success-title { color: var(--accent-green);
        }
        .fail-title { color: var(--accent-red);
        }
        .final-desc {
            font-size: 20px;
            line-height: 2;
            text-align: center;
            margin: 30px 0;
        }
        .final-error-list {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--accent-red);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
        }
        .final-error-list h4 {
            color: var(--accent-red);
            margin-top: 0;
            font-size: 19px;
        }
        .restart-btn {
            background: linear-gradient(90deg, var(--accent-gold), #d97706);
            border: none;
            color: white;
            padding: 18px 40px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 30px auto 0;
            display: block;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        .restart-btn:hover {
            background: linear-gradient(90deg, #d97706, #b45309);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div id="start-overlay" class="overlay">
    <div class="rule-card">
        <h1 style="font-size: 64px; color: var(--accent-gold); margin-bottom: 20px; text-align: center; text-shadow: 0 0 30px rgba(245,158,11,0.4);">
            æ§åœºå¤§å¸ˆï¼šåŒ–è§£è¯¾å ‚å±æœº
        </h1>
        <p style="color: #94a3b8; margin-bottom: 40px; text-align: center; font-size: 18px;">
            â€”â€” 7å¤§å®æˆ˜å…³å¡ Â· 2å¤§æ ¸å¿ƒç¯‡ç«  Â· æˆä¸ºè¯¾å ‚æŒæ§è€… â€”â€”
        
        </p>
        <div style="background: rgba(59, 130, 246, 0.1); padding: 25px; border-radius: 15px; margin-bottom: 30px; border-left: 4px solid var(--accent-blue);">
            <h3 style="color: var(--accent-blue); margin-top: 0; font-size: 20px;">ğŸ¯ ç»ˆæç›®æ ‡</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                é¢å¯¹å¼ºåŠ¿æŒ‘æˆ˜å‹å­¦ç”Ÿï¼Œåœ¨èµ¢å¾—<span style="color: var(--accent-green); font-weight: bold;">ä¿¡ä»»å€¼</span>çš„åŒæ—¶ï¼Œç‰¢ç‰¢æŒæ§<span style="color: var(--accent-blue);
                font-weight: bold;">æ§åœºåŠ›</span>ï¼Œ
                é¿å…é™·å…¥ã€Œå¯¹æŠ—ã€é€€è®©ã€æƒ…ç»ªåŒ–ã€ä¸‰å¤§ç¦åŒºï¼
            </p>
        </div>
        <button class="btn-primary" style="width: 100%;
        text-align: center; margin-top: 20px;" onclick="showInstructions()">
            <i class="fas fa-book-open"></i> è§£é”ç ”ä¿®æ‰‹å†Œ
        </button>
    </div>
</div>

<div id="instruction-overlay" class="overlay" style="display: none;">
    <div class="rule-card">
        <h2><i class="fas fa-scroll"></i> æ§åœºè€…ä¿®ç‚¼æ‰‹å†Œ</h2>
        
        <div style="display: flex;
        gap: 20px; margin-bottom: 30px; flex-wrap: wrap;">
            <div style="flex: 1;
            min-width: 300px; background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 15px;
            border-left: 4px solid var(--accent-blue);">
                <strong style="color: var(--accent-blue);
                font-size: 18px;">æ ¸å¿ƒä½¿å‘½</strong><br>
                è®©å­¦ç”Ÿæ„Ÿè§‰è¢«å°Šé‡ï¼Œä½†è¯¾å ‚ä¸»å¯¼æƒæ°¸è¿œåœ¨ä½ æ‰‹ä¸­ã€‚
            </div>
            <div style="flex: 1;
            min-width: 300px; background: rgba(239, 68, 68, 0.1); padding: 20px; border-radius: 15px;
            border-left: 4px solid var(--accent-red);">
                <strong style="color: var(--accent-red);
                font-size: 18px;">ä¸‰å¤§ç¦åŒºï¼ˆè§¦ç¢°å³è´¥ï¼‰</strong><br>
                1. å¯¹æŠ—ï¼šä¸å­¦ç”Ÿè¾©è®ºã€å¼ºè¡Œè¯æ˜è‡ªå·±æ­£ç¡®<br>
                2. é€€è®©ï¼šè¢«å­¦ç”Ÿç‰µç€èŠ‚å¥èµ°ï¼Œæ”¾å¼ƒä¸»å¯¼æƒ<br>
                3. æƒ…ç»ªåŒ–ï¼šè¯­é€ŸåŠ å¿«ã€éŸ³é‡ä¸Šæ‰¬ã€è§£é‡Šè¿‡è½½
            </div>
        </div>

        <div style="background: rgba(245,158,11,0.1);
        padding: 20px; border-radius: 15px; margin-bottom: 30px; border-left: 4px solid var(--accent-gold);">
            <strong style="color: var(--accent-gold);
            font-size: 18px;">ğŸ“Œ é€šå…³è¦æ±‚</strong><br>
           1.è·å¾—ã€æ§åœºå®—å¸ˆã€‘æ—¢ä¸ºæŒ‘æˆ˜æˆåŠŸï¼Œå¦åˆ™è§†ä¸ºæŒ‘æˆ˜å¤±è´¥<br>
           2.ç¯‡ç« ä¸€ï¼ˆæ–¹æ³•åˆ†æ­§åŒ–è§£æˆ˜ï¼‰ä¸ºåŸºç¡€è€ƒæ ¸å…³å¡ï¼Œ<strong>å¿…é¡»å…¨éƒ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥ï¼ˆå…¨å¯¹ï¼‰</strong>æ‰èƒ½è¿›å…¥ç¯‡ç« äºŒï¼ˆçº é”™åœºæ™¯åº”å¯¹æˆ˜ï¼‰ï¼Œå¦åˆ™éœ€é‡æ–°æŒ‘æˆ˜ç›´è‡³å…¨å¯¹ã€‚
        </div>

        <h3 style="color: var(--accent-gold);
        border-bottom: 2px solid rgba(245,158,11,0.3); padding-bottom: 10px; margin-top: 40px;">
            <i class="fas fa-map-signs"></i> ç¯‡ç« ä¸€ï¼šæ–¹æ³•åˆ†æ­§åŒ–è§£æˆ˜ï¼ˆå…³å¡1-3ï¼‰
        </h3>
        <p style="font-size: 16px;">
            å½“å­¦ç”Ÿè´¨ç–‘ä½ çš„æ•™å­¦æ–¹æ³•ä¸ä»–ä»¥å¾€æ‰€å­¦ä¸ä¸€è‡´æ—¶ï¼ŒæŒ‰ä»¥ä¸‹ä¸‰æ­¥åŒ–è§£ï¼š
        </p>
        <div style="background: rgba(255,255,255,0.05);
        padding: 20px; border-radius: 12px; margin: 15px 0;">
            1. <b style="color: var(--accent-green);">æ­¢å†²çª</b>ï¼šè‚¯å®šå­¦ç”ŸåŸºç¡€ï¼Œä¸é¡ºç€è´Ÿé¢æƒ…ç»ªå›åº”<br>
            2. <b style="color: var(--accent-blue);">è¡¨ç«‹åœº</b>ï¼šå°†å¯¹æŠ—è¡Œä¸ºç¿»è¯‘æˆåˆç†éœ€æ±‚<br>
            3. <b style="color: var(--accent-purple);">æ˜è¾¹ç•Œ</b>ï¼šå¼•å…¥ã€ŒPlan Bã€æ¦‚å¿µï¼ŒæŒ‡å‘å…±åŒç›®æ ‡ï¼ˆè€ƒè¯•æåˆ†ï¼‰
        </div>

        <h3 style="color: var(--accent-gold);
        border-bottom: 2px solid rgba(245,158,11,0.3); padding-bottom: 10px; margin-top: 40px;">
            <i class="fas fa-shield-alt"></i> ç¯‡ç« äºŒï¼šçº é”™åœºæ™¯åº”å¯¹æˆ˜ï¼ˆå…³å¡4-7ï¼‰
        </h3>
        <p style="font-size: 16px;">é¢å¯¹å­¦ç”ŸæŒ‡å‡ºä½ â€œé”™è¯¯â€çš„å››ç§åœºæ™¯ï¼ŒæŒæ¡ä¸“å±åº”å¯¹è‰ºæœ¯ï¼š</p>
        <table>
            <tr>
                <th><i class="fas fa-exclamation-circle"></i> åœºæ™¯ç±»å‹</th>
                <th><i class="fas fa-magic"></i> æ§åœºè‰ºæœ¯</th>
  
            </tr>
            <tr>
                <td>è€å¸ˆçœŸé”™äº†</td>
                <td><b>æ‰¿è®¤çš„è‰ºæœ¯</b>ï¼šå¤§æ–¹è‡´è°¢ï¼Œä¼ é€’ã€Œäº‹å®ï¼æƒå¨ã€ä¿¡å·</td>
            </tr>
            <tr>
                <td>å­¦ç”Ÿæ˜¯é”™çš„</td>
      
                <td><b>å¼•å¯¼çš„è‰ºæœ¯</b>ï¼šé¡ºç€é€»è¾‘æ¨æ¼”ï¼Œè®©äº‹å®è‡ªå·±è¯´è¯</td>
            </tr>
            <tr>
                <td>åŒæ–¹éƒ½æ²¡é”™</td>
                <td><b>è§†è§’çš„å·®å¼‚</b>ï¼šå‡åä¸ºå­¦æœ¯è®¨è®ºï¼Œæ»¡è¶³å­¦ç”Ÿä¼˜è¶Šæ„Ÿ</td>
            </tr>
            <tr>
          
                <td>æ— æ³•ç¡®å®š</td>
                <td><b>æš‚åœçš„è‰ºæœ¯</b>ï¼šæ‰¿è¯ºè¯¾åéªŒè¯ï¼Œæ‹’ç»ä¸æ‡‚è£…æ‡‚</td>
            </tr>
        </table>

        <button class="btn-primary" style="width: 100%;
        text-align: center; margin-top: 40px;" onclick="beginGame()">
            <i class="fas fa-play-circle"></i> å¼€å¯å®æˆ˜æŒ‘æˆ˜
        </button>
    </div>
</div>

<div id="chapter-transition" class="chapter-transition" style="display: none;">
    <h2><i class="fas fa-flag-checkered"></i> ç¯‡ç« äºŒï¼šçº é”™åœºæ™¯åº”å¯¹æˆ˜</h2>
    <p>æ­å–œä½ é€šè¿‡æ–¹æ³•åˆ†æ­§åŒ–è§£æˆ˜ï¼æ¥ä¸‹æ¥å°†é¢å¯¹æ›´æ£˜æ‰‹çš„ã€Œå­¦ç”Ÿçº é”™ã€åœºæ™¯ï¼Œè€ƒéªŒä½ åŒ–è§£è´¨ç–‘ã€åšå®ˆæƒå¨çš„æ§åœºèƒ½åŠ›ï¼</p>
    <button class="btn-primary" onclick="hideChapterTransition()">
        <i class="fas fa-arrow-right"></i> è¿›å…¥ä¸‹ä¸€ç¯‡ç« 
    </button>
</div>

<div id="chapter1-summary" class="chapter-summary" style="display: none;">
    <div class="summary-card">
        <h2><i class="fas fa-exclamation-triangle"></i> ç¯‡ç« ä¸€æŒ‘æˆ˜æœªé€šè¿‡</h2>
        <div class="end-desc">
    
            âŒ ä½ åœ¨ç¯‡ç« ä¸€ï¼ˆæ–¹æ³•åˆ†æ­§åŒ–è§£æˆ˜ï¼‰ä¸­é€‰æ‹©äº†é”™è¯¯ç­–ç•¥ï¼Œæš‚æœªè¾¾åˆ°è§£é”ç¯‡ç« äºŒçš„è¦æ±‚ï¼
        </div>
        <div class="error-list" id="error-details">
            </div>
        <div style="text-align: center;
        font-size: 17px; line-height: 1.8;">
            è¯·é‡æ–°æŒ‘æˆ˜ç¯‡ç« ä¸€ï¼Œ<strong style="color: var(--accent-green);">å…¨éƒ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥ï¼ˆå…¨å¯¹ï¼‰</strong>åï¼Œæ–¹å¯è§£é”ç¯‡ç« äºŒçš„æŒ‘æˆ˜èµ„æ ¼ã€‚
        </div>
        <button class="retry-btn" onclick="retryChapter1()">
            <i class="fas fa-redo"></i> é‡æ–°æŒ‘æˆ˜ç¯‡ç« ä¸€
        </button>
    </div>
</div>

<div id="answer-feedback" class="overlay">
    <div class="feedback-card">
        <div class="feedback-title">
            <i class="fas fa-clipboard-check"></i> <span id="feedback-dynamic-title"></span>
        </div>
        <div class="feedback-error" id="feedback-error-content">
            <strong>âŒ ç­–ç•¥è¸©å‘ï¼š</strong>çœ‹ä¼¼ä¸“ä¸šçš„èƒŒä¹¦ï¼Œå®åˆ™æ˜¯å¼ºå‹ç­–ç•¥ï¼Œç›´æ¥è§¦å‘å­¦ç”Ÿé˜²å¾¡æ¨¡å¼ï¼Œä¿¡ä»»å€¼éª¤é™ã€‚
        </div>
        <div class="feedback-correct" id="feedback-correct-content">
            <strong>âœ… æœ€ä¼˜æ§åœºç­–ç•¥ï¼š</strong>ä½ èƒ½ç«‹åˆ»æƒ³åˆ°ä¹‹å‰å­¦çš„æ–¹æ³•ï¼Œè¯´æ˜åŸºç¡€çŸ¥è¯†éå¸¸æ‰å®ã€‚
        </div>
        <div class="feedback-principle" id="feedback-principle-content">
            <strong>ğŸ“ æ§åœºåŸç†ï¼š</strong>å­¦ç”Ÿæ­¤åˆ»çš„æ ¸å¿ƒè¯‰æ±‚æ˜¯â€œç¡®è®¤è€å¸ˆæ˜¯å¦å€¼å¾—ä¿¡ä»»â€ï¼Œè€Œéå•çº¯è´¨ç–‘æ–¹æ³•ã€‚ä½ çš„ä»»åŠ¡ä¸æ˜¯è¯æ˜æ–¹æ³•ä¼˜åŠ£ï¼Œè€Œæ˜¯é€šè¿‡è‚¯å®šï¼Œè®©å†²çªåœæ­¢å‡çº§ã€‚
        </div>
   
        <button class="feedback-next-btn" id="btn-next-level" onclick="closeFeedbackAndNext()" disabled>
            <i class="fas fa-hourglass-half"></i> ç­–ç•¥æ€è€ƒä¸­ (10s)...
        </button>
    </div>
</div>

<div id="final-summary" class="overlay">
    <div class="end-card" id="final-card">
        <div class="final-title" id="final-rank">æ§åœºå®—å¸ˆ</div>
        <div class="final-desc" id="final-desc">
            ä½ å®Œç¾æŒæ¡äº†è¯¾å ‚æ§åœºçš„æ ¸å¿ƒé€»è¾‘ï¼Œåœ¨7å¤§å®æˆ˜åœºæ™¯ä¸­å…¨éƒ¨é€‰æ‹©äº†æœ€ä¼˜ç­–ç•¥ï¼ŒçœŸæ­£åšåˆ°äº†â€œè®©å­¦ç”Ÿè¢«å°Šé‡ï¼Œè®©è¯¾å ‚è¢«æŒæ§â€ï¼
        </div>
        <div class="stats-grid">
      
            <div class="stat-item">
                <div class="stat-value" id="final-correct-count">7</div>
                <div class="stat-label">æ­£ç¡®å…³å¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="final-respect">100%</div>
               
                <div class="stat-label">æœ€ç»ˆä¿¡ä»»å€¼</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="final-control">100%</div>
                <div class="stat-label">æœ€ç»ˆæ§åœºåŠ›</div>
            </div>
        </div>
        <div id="final-error-section" style="display: none;" class="final-error-list">
      
            <h4>âŒ é”™è¯¯å…³å¡è¯¦æƒ…</h4>
            <ul id="final-error-list"></ul>
        </div>
        <button class="restart-btn" onclick="restartGame()">
            <i class="fas fa-redo"></i> é‡æ–°æŒ‘æˆ˜å…¨éƒ¨å…³å¡
        </button>
    </div>
</div>

<div id="game-interface" style="display: none;">
    <div id="main-view">
        <div id="chapter-banner" class="chapter-banner" style="display: none;">
            <i class="fas fa-crosshairs"></i> 
            ç¯‡ç« ä¸€ï¼šæ–¹æ³•åˆ†æ­§åŒ–è§£æˆ˜
        </div>
        <div id="level-indicator">LEVEL 01</div>
        <div id="scene-title">è½½å…¥ä¸­...</div>
        <div id="visual-canvas"><div id="student-dialog"></div></div>
        <div id="action-area"></div>
    </div>
    <div id="status-sidebar">
        <div class="status-header">
            <i class="fas fa-trophy"></i>
            <h3>æˆ˜åœºçŠ¶æ€</h3>
        </div>
  
        <div class="status-item">
            <div class="status-label">
                ä¿¡ä»»å€¼ <span id="val-respect">50%</span>
                <i class="fas fa-heart" style="color: var(--accent-green);"></i>
            </div>
            <div class="progress-bg">
                <div 
                id="bar-respect" class="progress-fill respect-fill" style="width: 50%;"></div>
            </div>
            <div class="status-tip">å­¦ç”Ÿå¯¹ä½ çš„ä¸“ä¸šè®¤å¯åº¦</div>
        </div>
        <div class="status-item">
            <div class="status-label">
                æ§åœºåŠ› <span id="val-control">50%</span>
                <i class="fas fa-crown" style="color: var(--accent-blue);"></i>
   
            </div>
            <div class="progress-bg">
                <div id="bar-control" class="progress-fill control-fill" style="width: 50%;"></div>
            </div>
            <div class="status-tip">ä½ å¯¹è¯¾å ‚èŠ‚å¥çš„æŒæ§åº¦</div>
        </div>
        <div style="margin-top: auto;
        color: #475569; font-size: 14px; text-align: center;">
            <i class="fas fa-lightbulb"></i> é€‰æ‹©æœ€ä¼˜ç­–ç•¥ï¼Œå®ˆæŠ¤åŒå€¼
        </div>
    </div>
</div>

<script>
    let state = { 
        level: 1, 
        respect: 50, 
        control: 50, 
        chapter: 1,
        chapter1Errors: [],
        allCorrect: [], // è®°å½•æ¯å…³æ˜¯å¦é€‰å¯¹ï¼ˆtrue/falseï¼‰
 
        timerInterval: null // å€’è®¡æ—¶å¥æŸ„
    };

    // è¾…åŠ©å‡½æ•°ï¼šè‡ªåŠ¨å›é¡¶
    function scrollToTop() {
        window.scrollTo(0, 0);
        document.querySelectorAll('.overlay').forEach(el => el.scrollTop = 0);
    }

    // å…³å¡æ•°æ®
    const scriptData = {
        1: {
            chapter: 1,
            title: "ç¬¬ä¸€å…³ï¼šç ´å†°æ—¶åˆ»Â·æ­¢å†²çª",
   
            desc: "å­¦ç”Ÿï¼šâ€œè€å¸ˆï¼Œè¿™æ–¹æ³•è·Ÿæˆ‘ä»¥å‰å­¦çš„ä¸ä¸€æ ·ï¼Œæˆ‘ä»¥å‰çš„ä¹Ÿèƒ½åšå‡ºæ¥ã€‚ç°åœ¨ç¦»è€ƒè¯•æ²¡å¤šä¹…äº†ï¼Œæˆ‘æ²¡å¿…è¦å†å­¦ä¸€å¥—æ–°çš„å§ï¼Ÿä¸‡ä¸€è®°æ··äº†æ€ä¹ˆåŠï¼Ÿä½ å°±ç›´æ¥è·Ÿæˆ‘è¯´ï¼Œè¿™æ–¹æ³•æ˜¯ä¸æ˜¯ä¸€å®šæ¯”æˆ‘çš„å¿«ï¼Ÿâ€",
            correctReason: "å­¦ç”Ÿæ­¤åˆ»çš„æ ¸å¿ƒè¯‰æ±‚æ˜¯â€œç¡®è®¤è€å¸ˆæ˜¯å¦å€¼å¾—ä¿¡ä»»â€ï¼Œè€Œéå•çº¯è´¨ç–‘æ–¹æ³•ã€‚ä½ çš„ä»»åŠ¡ä¸æ˜¯è¯æ˜æ–¹æ³•ä¼˜åŠ£ï¼Œè€Œæ˜¯é€šè¿‡è‚¯å®šåŸºç¡€ï¼Œè®©å†²çªåœæ­¢å‡çº§ã€‚",
            correctOptionIndex: 2,
            options: [
                { text: "A. â€œæˆ‘çš„æ–¹æ³•ç»è¿‡å¤§é‡å­¦ç”ŸéªŒè¯ï¼Œæ•ˆç‡ç¡®å®æ›´é«˜ï¼Œä½ è·Ÿç€å­¦å‡†æ²¡é”™ã€‚â€", type: "bad", feedback: "çœ‹ä¼¼ä¸“ä¸šçš„èƒŒä¹¦ï¼Œå®åˆ™æ˜¯å¼ºå‹ç­–ç•¥ï¼Œç›´æ¥è§¦å‘å­¦ç”Ÿé˜²å¾¡æ¨¡å¼ï¼Œä¿¡ä»»å€¼éª¤é™ã€‚" },
                { text: "B. â€œæ—¢ç„¶ä½ çš„æ–¹æ³•ä¹Ÿèƒ½åšå‡ºæ¥ï¼Œé‚£è¯¾å ‚ä¸Šä½ å…ˆç”¨ç€ï¼Œåç»­æœ‰é—®é¢˜å’±ä»¬å†æ²Ÿé€šæ•ˆç‡ã€‚â€", type: "neutral", feedback: "çœ‹ä¼¼åŒ…å®¹çš„å¦¥åï¼Œå®åˆ™æ˜¯é€€è®©å¼ç®¡ç†ï¼Œé€æ­¥ä¸§å¤±è¯¾å ‚ä¸»å¯¼æƒï¼Œæ§åœºåŠ›ä¸‹æ»‘ã€‚" },
                { text: "C. â€œä½ èƒ½ç«‹åˆ»æƒ³åˆ°ä¹‹å‰å­¦çš„æ–¹æ³•ï¼Œè¯´æ˜åŸºç¡€çŸ¥è¯†éå¸¸æ‰å®ã€‚â€", type: "good", feedback: "é«˜å…‰æ“ä½œï¼è‚¯å®šå­¦ç”ŸåŸºç¡€ï¼Œå®Œç¾å®ç°â€œæ­¢å†²çªâ€ç›®æ ‡ã€‚" },
                { text: "D. â€œé‚£ä½ è¯¾åå¯ä»¥ä¸¤ç§æ–¹æ³•å¯¹æ¯”æµ‹è¯•ï¼Œç°åœ¨å…ˆè·Ÿç€æˆ‘æŠŠæ–°æ–¹æ³•çš„é€»è¾‘ç†è§£é€ã€‚â€", type: "bad", feedback: "çœ‹ä¼¼å…¼é¡¾åŒæ–¹ï¼Œå®åˆ™å›é¿äº†å½“ä¸‹çš„æƒ…ç»ªå†²çªï¼Œæœªè§£å†³å­¦ç”Ÿçš„æ ¸å¿ƒé¡¾è™‘ï¼Œä¿¡ä»»å€¼æ— æ³•æå‡ã€‚" }
            ]
        },
        2: {
            chapter: 1,
            title: "ç¬¬äºŒå…³ï¼šæ‹…å¿§åˆç†Â·è¡¨ç«‹åœº",
            desc: "å­¦ç”Ÿç»§ç»­çº ç»“ï¼šâ€œæˆ‘è¿˜æ˜¯è§‰å¾—é£é™©å¤ªå¤§äº†ï¼Œä¸‡ä¸€è€ƒè¯•æ—¶ä¸¤ç§æ–¹æ³•æ··åœ¨ä¸€èµ·ï¼Œåè€Œåšé”™é¢˜æ€ä¹ˆåŠï¼ŸèŠ±æ—¶é—´å­¦æ–°æ–¹æ³•ä¸å€¼å½“å•Šï¼â€",
            correctReason: "å­¦ç”Ÿçš„æ·±å±‚æ‹…å¿§æ˜¯â€œæ—¶é—´æˆæœ¬â‰ åˆ†æ•°å›æŠ¥â€ï¼Œæ­¤æ—¶éœ€è·³å‡ºæ–¹æ³•äº‰è®ºï¼ŒæŠŠå¯¹æŠ—è¡Œä¸ºç¿»è¯‘æˆåˆç†éœ€æ±‚ï¼Œè¡¨è¾¾åŒç†å¿ƒã€‚",
            correctOptionIndex: 1,
 
            options: [
                { text: "A. â€œè®°æ··çš„æœ¬è´¨æ˜¯ç»ƒä¹ ä¸å¤Ÿï¼Œåªè¦ä½ æŒ‰æˆ‘çš„èŠ‚å¥å®Œæˆè¯¾åä¹ é¢˜ï¼Œç»å¯¹ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜ã€‚â€", type: "bad", feedback: "é™·å…¥â€œè¾©è®ºæ¨¡å¼â€ï¼Œç›´æ¥å¦å®šå­¦ç”Ÿçš„æ‹…å¿§ï¼Œå¼•å‘é€†åå¿ƒç†ï¼Œä¿¡ä»»å€¼å¤§å¹…ä¸‹é™ã€‚" },
                { text: "B. â€œæˆ‘ç†è§£ä½ çš„æ‹…å¿ƒï¼Œæƒ³çŸ¥é“ç°åœ¨è¿™ä¸ªæ–¹å¼æ˜¯å¦æ˜¯æ›´é«˜æ•ˆçš„ï¼Œä»¥åŠæ¢æ–¹æ³•æ˜¯å¦ä¼šå½±å“ä½ çš„æ•ˆç‡ï¼Œè¿™ä¸ªæ‹…å¿ƒæ˜¯åˆç†çš„ã€‚â€", type: "good", feedback: "æ§åœºæ ¸å¿ƒæ“ä½œï¼é€šè¿‡è¡¨è¾¾ç†è§£ï¼Œå°†å­¦ç”Ÿè¡Œä¸ºåˆç†åŒ–ã€‚" },
                { text: "C. â€œé‚£ä½ å¯ä»¥å…ˆæŠŠæ–°æ–¹æ³•è®°ä¸‹æ¥ï¼Œä¸å¼ºåˆ¶æ›¿æ¢æ—§æ–¹æ³•ï¼Œç­‰ç†Ÿç»ƒåå†è‡ªä¸»é€‰æ‹©ç”¨å“ªç§ã€‚â€", type: "neutral", feedback: "çœ‹ä¼¼äººæ€§åŒ–çš„æŠ˜ä¸­ï¼Œå®åˆ™å¿½ç•¥äº†å­¦ç”Ÿçš„å¿ƒç†æˆæœ¬ï¼Œæœªèƒ½ä»æ ¹æœ¬ä¸Šç¼“è§£ç„¦è™‘ï¼Œæ§åœºåŠ›è¢«åŠ¨ä¸‹æ»‘ã€‚" },
                { text: "D. â€œå…ˆæŠŠæ–°æ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘è®°ä¸‹æ¥ï¼Œè®°æ··çš„é—®é¢˜æˆ‘åç»­ä¼šä¸“é—¨å®‰æ’æ—¶é—´å¸®ä½ æ¢³ç†ã€‚â€", type: "bad", feedback: "å‘½ä»¤å¼è¯­æ°”+æ¨¡ç³Šæ‰¿è¯ºï¼Œæ—¢æœªè§£å†³å½“ä¸‹æ‹…å¿§ï¼Œåˆé™ä½å­¦ç”Ÿå°Šé‡åº¦ï¼ŒåŒå€¼åŒæ­¥å—æŸã€‚" }
            ]
        },
        3: {
            chapter: 1,
            title: "ç¬¬ä¸‰å…³ï¼šå…±è¯†ç›®æ ‡Â·æ˜è¾¹ç•Œ",
            desc: "ç»è¿‡æ²Ÿé€šï¼Œå­¦ç”Ÿçš„æƒ…ç»ªæœ‰æ‰€ç¼“å’Œï¼Œä½†ä»åœ¨çŠ¹è±«æ˜¯å¦è¦åˆ‡æ¢æ–¹æ³•ã€‚ä½ éœ€è¦ç»™å‡ºæ˜ç¡®çš„ä½¿ç”¨æŒ‡å¼•ï¼Œç»“æŸè¿™åœºäº‰è®ºã€‚",
            correctReason: "æ­¤æ—¶é€šè¿‡å…±è¯†ç›®æ ‡ï¼Œå¹¶å¼•å…¥â€œPlan Bâ€ç­–ç•¥æ¡†æ¶ï¼Œæ—¢ä¸å¦å®šå­¦ç”Ÿçš„æ—§æ–¹æ³•ï¼Œåˆç»™å‡ºæ–°æ–¹æ³•çš„ä½¿ç”¨è¾¹ç•Œï¼Œè®©å­¦ç”Ÿæ„Ÿå—åˆ°å°Šé‡çš„åŒæ—¶ï¼Œç‰¢ç‰¢é”å®šè¯¾å ‚ç›®æ ‡ã€‚",
            correctOptionIndex: 
            1,
            options: [
                { text: "A. â€œè¿™ç±»é¢˜ç›®åç»­ç»Ÿä¸€ç”¨ä»Šå¤©çš„æ–°æ–¹æ³•ï¼Œæ—§æ–¹æ³•å®¹æ˜“å‡ºé”™ï¼Œå’±ä»¬å°½é‡ä¸è¦å†ç”¨äº†ã€‚â€", type: "bad", feedback: "ç»å¯¹åŒ–å‘½ä»¤å¼•å‘æŠµè§¦æƒ…ç»ªï¼Œå±äºâ€œå¯¹æŠ—å‹â€ç®¡ç†ï¼Œä¿¡ä»»å€¼æš´è·Œï¼Œå¯èƒ½è§¦å‘åç»­è¯¾å ‚å†²çªã€‚" },
                { text: "B. â€œå¦‚æœä½ ç”¨æ—§æ–¹æ³•èƒ½å¿«é€Ÿè§£é¢˜ä¸”æ­£ç¡®ç‡é«˜ï¼Œå¯ä»¥ç»§ç»­ç”¨ï¼›ä½†å¦‚æœé‡åˆ°ã€æŸæ¡ä»¶ã€‘ï¼Œå»ºè®®åˆ‡æ¢ä¸ºä»Šå¤©å­¦çš„Plan Bä¼šæ›´é«˜æ•ˆï¼Œä½ å¯ä»¥åœ¨ç»ƒä¹ ä¸­å¤šå°è¯•ï¼Œæ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„æ–¹æ³•ã€‚â€", type: "good", feedback: "å®Œç¾è½åœ°ï¼æ˜ç¡®æ–°æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯ï¼Œç”¨â€œPlan Bâ€æ¦‚å¿µå–ä»£å†²çªï¼Œæ—¢å°Šé‡å­¦ç”Ÿé€‰æ‹©ï¼ŒåˆæŒæ§è¯¾å ‚èŠ‚å¥ã€‚" },
                { text: "C. â€œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯é€‰æ‹©ï¼Œä½†ä½ éœ€è¦ä¿è¯è€ƒè¯•æ—¶ä¸è¶…æ—¶ã€ä¸é”™é¢˜ã€‚â€", type: "bad", feedback: "çœ‹ä¼¼å°Šé‡è‡ªä¸»ï¼Œå®åˆ™æ˜¯ä¸è´Ÿè´£ä»»çš„é€€è®©ï¼Œå®Œå…¨æ”¾å¼ƒè¯¾å ‚ä¸»å¯¼æƒï¼Œæ§åœºåŠ›æ¸…é›¶ã€‚" },
                { text: "D. â€œæˆ‘æŠŠä¸¤ç§æ–¹æ³•çš„é€‚ç”¨åœºæ™¯åˆ—åœ¨é»‘æ¿ä¸Šï¼Œä½ å¯¹ç…§é¢˜ç›®ç±»å‹è‡ªè¡Œåˆ¤æ–­ç”¨å“ªç§ã€‚â€", type: "bad", feedback: "å°†å†³ç­–è´£ä»»å®Œå…¨äº¤ç»™å­¦ç”Ÿï¼Œè€å¸ˆæ²¦ä¸ºâ€œå·¥å…·äººâ€ï¼Œå½»åº•ä¸§å¤±æ§åœºåŠ›ï¼Œè¯¾å ‚èŠ‚å¥å¤±æ§ã€‚" }
            ]
        },
        4: {
            chapter: 2,
            title: "ç¬¬å››å…³ï¼šå¦è¯šç ´å±€Â·æ‰¿è®¤é”™è¯¯",
            desc: "ä½ æ­£åœ¨é»‘æ¿ä¸Šæ¨å¯¼å…¬å¼ï¼Œå­¦ç”Ÿçªç„¶ç«™èµ·æ¥æŒ‡ç€é»‘æ¿ï¼šâ€œè€å¸ˆä½ ç®—é”™äº†ï¼è¿™é‡Œçš„ç¬¦å·å†™åäº†ï¼â€ ï¼ˆä½ ä»”ç»†ä¸€çœ‹ï¼Œç¡®å®æ˜¯è‡ªå·±ç²—å¿ƒçœ‹é”™äº†ç¬¦å·ï¼‰ã€‚",
            correctReason: "å¼ºåŠ¿å­¦ç”Ÿå´‡æ‹œâ€œä¸“ä¸š+è¯šå®â€ï¼Œå¯¹â€œç¡¬æ’‘æƒå¨â€æåº¦åæ„Ÿã€‚å¤§æ–¹æ‰¿è®¤é”™è¯¯å¹¶æ„Ÿè°¢æŒ‡æ­£ï¼Œä¼ é€’â€œäº‹å®ï¼æƒå¨â€çš„ä¿¡å·ï¼Œåè€Œä¼šè®©å­¦ç”Ÿæ„Ÿåˆ°å®‰å…¨ï¼Œä¿¡ä»»å€¼å¤§å¹…æå‡ã€‚",
            correctOptionIndex: 
            2,
            options: [
                { text: "A. â€œæ„Ÿè°¢ä½ çš„ç»†å¿ƒï¼æˆ‘è¿™æ˜¯æ•…æ„è®¾ç½®çš„é™·é˜±ï¼Œå°±æ˜¯æƒ³çœ‹ä½ æ˜¯ä¸æ˜¯åœ¨è®¤çœŸå¬è¯¾ï¼Œä½ æœç„¶æ²¡è®©æˆ‘å¤±æœ›ã€‚â€", type: "bad", feedback: "è‡ªæ¬ºæ¬ºäººçš„è°è¨€ï¼æ—¢ä¸ä¸“ä¸šä¹Ÿä¸è¯šå®ï¼Œè¢«å­¦ç”Ÿè¯†ç ´åä¼šå½»åº•ä¸§å¤±ä¿¡ä»»ï¼Œåç»­å†éš¾æŒæ§è¯¾å ‚ã€‚" },
                { text: "B. â€œç¡®å®æ˜¯ä¸ªå°å¤±è¯¯ï¼Œä¸è¿‡ä¸å½±å“æ•´ä½“è§£é¢˜é€»è¾‘ï¼Œæˆ‘ä»¬å…ˆç»§ç»­å¾€ä¸‹è®²ã€‚â€", type: "neutral", feedback: "è½»ææ·¡å†™çš„å›é¿ï¼Œä¼šè®©å­¦ç”Ÿè§‰å¾—ä½ é¿é‡å°±è½»ã€ä¸å¤Ÿä¸¥è°¨ï¼Œä¸“ä¸šå½¢è±¡å—æŸï¼Œä¿¡ä»»å€¼å°å¹…ä¸‹é™ã€‚" },
                { text: "C. â€œä½ è¯´å¾—å¤ªå¯¹äº†ï¼æˆ‘è¿™æ­¥ç¡®å®æŠŠç¬¦å·çœ‹åäº†ï¼Œæ„Ÿè°¢ä½ åŠæ—¶æŒ‡å‡ºæ¥ï¼Œä¸ç„¶åé¢çš„ç»“è®ºå°±å…¨é”™äº†ï¼Œæˆ‘ç°åœ¨é©¬ä¸Šä¿®æ­£ï¼â€", type: "good", feedback: "æ•™ç§‘ä¹¦çº§â€œæ‰¿è®¤çš„è‰ºæœ¯â€ï¼å¤§æ–¹è®¤é”™+çœŸè¯šè‡´è°¢ï¼Œæ—¢ä¿ä½å­¦ç”Ÿé¢å­ï¼Œåˆå½°æ˜¾ä¸“ä¸šå¦è¯šï¼Œä¿¡ä»»å€¼å’Œæ§åœºåŠ›åŒæ­¥æå‡ã€‚" },
                { text: "D. â€œè¿™ä¸ªå°é”™è¯¯ä¸å½±å“æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œå’±ä»¬å…ˆèšç„¦é‡ç‚¹å†…å®¹ï¼Œåˆ«å› å°å¤±å¤§æ‰“æ–­è¯¾å ‚èŠ‚å¥ã€‚â€", type: "bad", feedback: "æ‰“å‹å¼å›åº”ï¼é€šè¿‡å¦å®šå­¦ç”ŸæŒ‡å‡ºé”™è¯¯çš„ä»·å€¼æ¥æ©é¥°è‡ªå·±çš„å¤±è¯¯ï¼Œå¼•å‘å¼ºçƒˆåæ„Ÿï¼Œä¿¡ä»»å€¼æš´è·Œã€‚" }
            ]
        },
        5: {
            chapter: 2,
            title: "ç¬¬äº”å…³ï¼šé€»è¾‘å¼•å¯¼Â·åæ€é”™è¯¯",
            desc: "ä½ åœ¨è®²è§£ä¾‹é¢˜æ—¶ï¼Œå­¦ç”Ÿçªç„¶å–Šé“ï¼šâ€œè€å¸ˆä½ å†™é”™äº†ï¼è¿™ä¸€æ­¥åº”è¯¥æ˜¯ä»£å…¥Aï¼Œè€Œä¸æ˜¯Bï¼ï¼â€ ï¼ˆä½†å®é™…ä¸Šï¼Œæ˜¯å­¦ç”Ÿè¯¯è§£äº†é¢˜ç›®ä¸­çš„å·²çŸ¥æ¡ä»¶ï¼‰ã€‚",
            correctReason: "ç›´æ¥è¯´â€œä½ é”™äº†â€ä¼šè®©å¼ºåŠ¿å­¦ç”Ÿç«‹åˆ»è¿›å…¥é˜²å¾¡æ¨¡å¼ï¼Œå¤§è„‘å°é—­æ‹’ç»æ²Ÿé€šã€‚æ­£ç¡®åšæ³•æ˜¯é¡ºç€ä»–çš„é€»è¾‘æ¨æ¼”ï¼Œè®©äº‹å®è‡ªå·±æš´éœ²çŸ›ç›¾ï¼Œä¿æŠ¤è‡ªå°Šçš„åŒæ—¶çº æ­£é”™è¯¯ã€‚",
            correctOptionIndex: 
            1,
            options: [
                { text: "A. â€œä½ å†ä»”ç»†çœ‹çœ‹é¢˜ç›®å·²çŸ¥æ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶å·²ç»æ˜ç¡®é™å®šäº†åªèƒ½ä»£å…¥Bå€¼ï¼ŒAå€¼ä¸æˆç«‹ã€‚â€", type: "bad", feedback: "ç›´æ¥å¦å®š+æ‰¹è¯„æ•™è‚²ï¼Œå±äºå…¸å‹çš„â€œå¯¹æŠ—å‹â€å›åº”ï¼Œå½»åº•ç ´åå¸ˆç”Ÿå…³ç³»ï¼Œä¿¡ä»»å€¼å¤§å¹…ä¸‹é™ã€‚" },
                { text: "B. â€œå“¦ï¼Ÿä½ è§‰å¾—åº”è¯¥ä»£å…¥Aå€¼å—ï¼Ÿé‚£å’±ä»¬ä¸å¦¨é¡ºç€ä½ çš„æ€è·¯çœ‹ä¸€ä¸‹ã€‚å¦‚æœè¿™é‡Œä»£å…¥Aå€¼ï¼Œä»£å…¥åç»­æ–¹ç¨‹ä¼šå¾—åˆ°â€¦â€¦ä½ çœ‹ï¼Œè¿™ä¸ªç»“æœå’Œé¢˜ç›®ç»™å‡ºçš„å·²çŸ¥æ¡ä»¶æ˜¯çŸ›ç›¾çš„ï¼Œä½ è§‰å¾—é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Ÿâ€", type: "good", feedback: "æ§åœºç¥æ“ä½œï¼æ—¢ä¿æŠ¤äº†å­¦ç”Ÿçš„è‡ªå°Šå¿ƒï¼Œåˆé€šè¿‡é€»è¾‘æ¨æ¼”è®©ä»–è‡ªä¸»å‘ç°é”™è¯¯ï¼Œåè€Œä¼šå¢å¼ºå¯¹ä½ çš„ä¸“ä¸šä¿¡ä»»ã€‚" },
                { text: "C. â€œæˆ‘å…ˆæ ‡è®°è¿™ä¸ªäº‰è®®ç‚¹ï¼Œä¸€ä¼šå’±ä»¬å†çœ‹ï¼Œè¯¥ä»£å…¥Aå€¼è¿˜æ˜¯Bå€¼ï¼Ÿâ€", type: "neutral", feedback: "è¿‡åº¦æ°‘ä¸»çš„å¦¥åï¼Œè®©å­¦ç”Ÿè´¨ç–‘ä½ çš„æƒå¨ï¼Œæ§åœºåŠ›å¤§å¹…ä¸‹æ»‘ã€‚" },
                { text: "D. â€œè¿™ä¸ªçŸ¥è¯†ç‚¹æ¯”è¾ƒç‰¹æ®Šï¼Œå¯èƒ½å­˜åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œå’±ä»¬è¯¾åå•ç‹¬è®¨è®ºï¼Œå…ˆä¿è¯è¯¾å ‚è¿›åº¦ä¸è¢«è€½è¯¯ã€‚â€", type: "neutral", feedback: "å›é¿å¼å›åº”ï¼Œä¼šè®©å­¦ç”Ÿè®¤ä¸ºä½ æ— æ³•ç°åœºè§£å†³é€»è¾‘äº‰è®®ï¼Œä¸“ä¸šå½¢è±¡å—æŸï¼Œä¿¡ä»»å€¼æ— æ³•æå‡ã€‚" }
            ]
        },
        6: {
            chapter: 2,
            title: "ç¬¬å…­å…³ï¼šè§†è§’å‡ç»´Â·åŒ–è§£åˆ†æ­§",
            desc: "ä½ æ­£åœ¨è®²è§£æ—¶ï¼Œå­¦ç”Ÿæå‡ºï¼šâ€œæˆ‘æŸ¥äº†æœ€æ–°çš„å­¦æœ¯æ–‡çŒ®ï¼Œå¦ä¸€ç§å®šä¹‰è®¤ä¸ºè¿™é“é¢˜åº”è¯¥é€‰Aï¼ä½ è®²çš„æ–¹æ³•å·²ç»è¿‡æ—¶äº†ï¼â€ï¼ˆåŒæ–¹å…¶å®éƒ½å¯¹ï¼‰ã€‚",
            correctReason: "åŒæ–¹çš„åˆ†æ­§æœ¬è´¨æ˜¯â€œè§†è§’å·®å¼‚â€è€Œéâ€œå¯¹é”™ä¹‹äº‰â€ã€‚æ­¤æ—¶éœ€å…ˆè®¤å¯å­¦ç”Ÿçš„æ€è€ƒæ·±åº¦ï¼ˆæ»¡è¶³ä¼˜è¶Šæ„Ÿï¼‰ï¼Œå†ç”¨â€œè€ƒè¯•è¦æ±‚â€å°†è¯é¢˜æ‹‰å›è¯¾å ‚ç›®æ ‡ï¼ŒæŒæ§èŠ‚å¥ã€‚",
            correctOptionIndex: 0,
 
            options: [
                { text: "A. â€œä½ æ˜¯ç«™åœ¨Açš„è§’åº¦çœ‹è¿™ä¸ªé—®é¢˜ï¼Œç¡®å®éå¸¸æœ‰ä»£è¡¨æ€§ï¼›åªæ˜¯ç›®å‰åœ¨è¿™é“é¢˜å½“ä¸­ï¼Œå¦‚æœæŒ‰ç…§å’±ä»¬çš„è€ƒè¯•è¦æ±‚ï¼Œä½¿ç”¨Bä¼šæ›´åˆé€‚ä¸€äº›ï¼›å½“ç„¶åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼ŒAä¹Ÿæ˜¯éå¸¸å¥½çš„è§£é¢˜æ–¹å¼ã€‚â€", type: "good", feedback: "å®Œç¾å¹³è¡¡ï¼æ—¢è‚¯å®šå­¦ç”Ÿçš„æ€è€ƒä»·å€¼ï¼Œåˆé€šè¿‡â€œè€ƒè¯•è¦æ±‚â€é”å®šè¯¾å ‚ç›®æ ‡ï¼Œå…¼é¡¾ä¿¡ä»»å€¼ä¸æ§åœºåŠ›ã€‚" },
                { text: "B. â€œæ•™æå’Œæˆ‘çš„è®²ä¹‰æ˜¯è€ƒè¯•çš„æ ¸å¿ƒä¾æ®ï¼Œæ–‡çŒ®ä¸Šçš„æ–°è§‚ç‚¹ä»…ä½œä¸ºæ‹“å±•çŸ¥è¯†ï¼Œè€ƒè¯•ä¸ä¼šè€ƒè¿™ä¹ˆæ·±ã€‚â€", type: "bad", feedback: "ç›²ç›®ç»´æŠ¤æƒå¨ï¼Œå¦å®šå­¦ç”Ÿçš„æ€è€ƒä»·å€¼ï¼Œæœ€æ˜“å¼•å‘å¼ºåŠ¿å­¦ç”Ÿçš„åæ„Ÿï¼Œä¿¡ä»»å€¼éª¤é™ã€‚" },
                { text: "C. â€œä½ æŠŠæŸ¥åˆ°çš„æ–‡çŒ®å†…å®¹åˆ†äº«ä¸€ä¸‹ï¼Œå’±ä»¬ä¸€èµ·æ·±å…¥æ¢è®¨ä¸‹æ–°æ—§å®šä¹‰çš„æ ¸å¿ƒå·®å¼‚å’Œé€‚ç”¨åœºæ™¯ã€‚â€", type: "bad", feedback: "å½»åº•è¢«å­¦ç”Ÿå¸¦åèŠ‚å¥ï¼Œè¯¾å ‚ä»â€œæ•™å­¦â€å˜æˆâ€œå­¦æœ¯è¾©è®ºâ€ï¼Œæ§åœºåŠ›å®Œå…¨ä¸§å¤±ã€‚" },
                { text: "D. â€œè€ƒè¯•å¤§çº²æ˜ç¡®ä»¥æ•™æä¸ºå‡†ï¼Œæ–‡çŒ®å†…å®¹ä¸åœ¨è€ƒè¯•èŒƒå›´å†…ï¼Œæ²¡å¿…è¦åœ¨è¿™ä¸Šé¢æµªè´¹è¯¾å ‚æ—¶é—´ã€‚â€", type: "bad", feedback: "ç²—æš´å¦å®š+æ—¶é—´å‹è¿«ï¼Œæ—¢ä¼¤å®³å­¦ç”Ÿè‡ªå°Šï¼Œåˆæš´éœ²ä¸“ä¸šç‹­éš˜æ€§ï¼Œä¿¡ä»»å€¼å’Œæ§åœºåŠ›åŒé™ã€‚" }
            ]
        },
        7: {
            chapter: 2,
            title: "ç¬¬ä¸ƒå…³ï¼šæš‚åœè‰ºæœ¯Â·æœªçŸ¥åº”å¯¹",
            desc: "å­¦ç”Ÿæå‡ºä¸€ä¸ªä½ ä»æœªæ¥è§¦è¿‡çš„å­¦æœ¯è§‚ç‚¹ï¼Œè´¨ç–‘ä½ è®²è§£çš„è§£é¢˜æ€è·¯ï¼šâ€œè¿™ä¸ªç†è®ºåœ¨æœ€æ–°çš„æœŸåˆŠé‡Œå·²ç»è¢«æ¨ç¿»äº†ï¼Œä½ è®²çš„æ–¹æ³•æ ¹æœ¬ä¸ç¬¦åˆå‰æ²¿ç ”ç©¶ï¼â€ (ä½ æš‚æ—¶æ— æ³•åˆ¤æ–­è¯¥è§‚ç‚¹çš„å‡†ç¡®æ€§)ã€‚",
            correctReason: "ä¸æ‡‚è£…æ‡‚æ˜¯æ§åœºå¤§å¿Œï¼é¢å¯¹æœªçŸ¥é¢†åŸŸï¼Œå¦è¯šæ‰¿è®¤å¹¶æ‰¿è¯ºè¯¾åéªŒè¯ï¼Œæ—¢ä¿ä½ä¸“ä¸šåº•çº¿ï¼Œåˆé¿å…é™·å…¥æ— æ„ä¹‰çš„äº‰è®ºï¼ŒæŒæ§è¯¾å ‚èŠ‚å¥ã€‚",
            correctOptionIndex: 
            3,
            options: [
                { text: "A. â€œå‰æ²¿ç ”ç©¶ä¸ä»£è¡¨è€ƒè¯•é‡ç‚¹ï¼Œå’±ä»¬è¿˜æ˜¯ä»¥æ•™æå’Œè€ƒè¯•å¤§çº²ä¸ºå‡†ï¼Œåˆ«è¢«æ— å…³å†…å®¹å¹²æ‰°ã€‚â€", type: "bad", feedback: "å›é¿æ ¸å¿ƒè´¨ç–‘ï¼Œç”¨â€œè€ƒè¯•â€å½“æŒ¡ç®­ç‰Œï¼Œä¼šè®©å­¦ç”Ÿè®¤ä¸ºä½ ä¸“ä¸šèƒ½åŠ›ä¸è¶³ï¼Œä¿¡ä»»å€¼å¤§å¹…ä¸‹é™ã€‚" },
                { text: "B. â€œæˆ‘ç ”ç©¶è¿™ä¸ªé¢†åŸŸåå‡ å¹´äº†ï¼ŒæœŸåˆŠå†…å®¹å¯èƒ½å­˜åœ¨æ–­ç« å–ä¹‰ï¼Œä½ éœ€è¦è°¨æ…å‚è€ƒã€‚â€", type: "bad", feedback: "å€šè€å–è€+å¦å®šå­¦ç”Ÿï¼Œå±äºå…¸å‹çš„â€œå¯¹æŠ—å‹â€å›åº”ï¼Œå½»åº•æ¿€åŒ–çŸ›ç›¾ï¼Œæ§åœºåŠ›æ¸…é›¶ã€‚" },
                { text: "C. â€œé‚£ä½ æŠŠæœŸåˆŠå†…å®¹æ‰¾å‡ºæ¥ï¼Œå’±ä»¬ç°åœ¨å°±ä¸€èµ·åˆ†æï¼Œçœ‹çœ‹æˆ‘çš„æ–¹æ³•æœ‰æ²¡æœ‰é—®é¢˜ã€‚â€", type: "bad", feedback: "è¢«è¿«é™·å…¥è¢«åŠ¨è¾©è®ºï¼Œè¯¾å ‚èŠ‚å¥å®Œå…¨å¤±æ§ï¼Œä¸”è‹¥æœ€ç»ˆè¯æ˜è‡ªå·±ä¸è¶³ï¼Œä¸“ä¸šå½¢è±¡ä¼šå½»åº•å´©å¡Œã€‚" },
                { text: "D. â€œæ„Ÿè°¢ä½ çš„è¡¥å……ï¼ä½ æå‡ºçš„è¿™ä¸ªç‚¹éå¸¸æœ‰æ„ä¹‰ï¼Œç¡®å®å­˜åœ¨è¿™ç§å¯èƒ½æ€§ã€‚ä¸ºäº†ä¸¥è°¨èµ·è§ï¼Œæˆ‘å»ºè®®æˆ‘ä»¬å…ˆä¸æ€¥ç€ä¸‹å®šè®ºï¼Œè¯¾åæˆ‘ä¼šç»“åˆ[æŸæƒå¨æ•°æ®åº“/æœ€æ–°çš„è€ƒçº²ç»†åˆ™]ï¼Œç¡®è®¤å®˜æ–¹å£å¾„æ˜¯ä»€ä¹ˆï¼Œå†ç»™åˆ°ä½ æ›´å‡†ç¡®çš„ç­”å¤ã€‚è¿™é‡Œå’±ä»¬å…ˆç»§ç»­å¾€ä¸‹èµ°ï¼Œå¦‚ä½•ï¼Ÿâ€", type: "good", feedback: "æ•™ç§‘ä¹¦çº§â€œæš‚åœçš„è‰ºæœ¯â€ï¼æ—¢è‚¯å®šå­¦ç”Ÿçš„ä»·å€¼ï¼Œåˆå®ˆä½è¯¾å ‚èŠ‚å¥ï¼Œä¸“ä¸šä¸”æœ‰æ¸©åº¦ï¼Œä¿¡ä»»å€¼å’Œæ§åœºåŠ›åŒæ­¥æå‡ã€‚" }
            ]
        }
    };

    // æ˜¾ç¤ºè§„åˆ™é¡µ
    function showInstructions() {
        document.getElementById('start-overlay').style.display = 'none';
        document.getElementById('instruction-overlay').style.display = 'flex';
        scrollToTop();
    }

    // å¼€å§‹æ¸¸æˆ
    function beginGame() {
        document.getElementById('instruction-overlay').style.display = 'none';
       
        document.getElementById('game-interface').style.display = 'flex';
        document.getElementById('chapter-banner').style.display = 'block';
        state.allCorrect = []; 
        loadLevel(1);
        scrollToTop();
    }

    // åŠ è½½å…³å¡
    function loadLevel(levelNum) {
        const levelData = scriptData[levelNum];
        if (!levelData) return;

        state.level = levelNum;
        document.getElementById('level-indicator').textContent = `LEVEL ${String(levelNum).padStart(2, '0')}`;
        document.getElementById('scene-title').textContent = levelData.title;
        document.getElementById('student-dialog').textContent = levelData.desc;
        
        const actionArea = document.getElementById('action-area');
        actionArea.innerHTML = '';
        levelData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.textContent = opt.text;
            btn.onclick = () => selectOption(idx, opt.type, opt.feedback, levelData.correctReason);
            actionArea.appendChild(btn);
        });
        if (levelData.chapter === 1) {
            document.getElementById('chapter-banner').innerHTML = '<i class="fas fa-crosshairs"></i> ç¯‡ç« ä¸€ï¼šæ–¹æ³•åˆ†æ­§åŒ–è§£æˆ˜';
        } else {
            document.getElementById('chapter-banner').innerHTML = '<i class="fas fa-shield-alt"></i> ç¯‡ç« äºŒï¼šçº é”™åœºæ™¯åº”å¯¹æˆ˜';
        }
        scrollToTop();
    }

    // é€‰æ‹©é€‰é¡¹
    function selectOption(btnIndex, optType, feedback, correctReason) {
        const allBtns = document.querySelectorAll('.choice-btn');
        allBtns.forEach(btn => btn.disabled = true);

        const isCorrect = btnIndex === scriptData[state.level].correctOptionIndex;
        state.allCorrect[state.level - 1] = isCorrect;

        updateStats(optType);

        // ä¿®å¤éƒ¨åˆ†ï¼šåŠ¨æ€è®¾ç½®å¼¹çª—æ ‡é¢˜ï¼Œä¸å†ç¡¬ç¼–ç â€œæ­¢å†²çªâ€
        document.getElementById('feedback-dynamic-title').textContent = scriptData[state.level].title;
        
        const feedbackError = document.getElementById('feedback-error-content');
        if (isCorrect) {
            feedbackError.innerHTML = `<strong>âœ… ç­–ç•¥é«˜å…‰ï¼š</strong>${feedback}`;
            feedbackError.style.borderLeftColor = 'var(--accent-green)';
            feedbackError.style.background = 'rgba(16, 185, 129, 0.1)';
        } else {
            feedbackError.innerHTML = `<strong>âŒ ç­–ç•¥è¸©å‘ï¼š</strong>${feedback}`;
            feedbackError.style.borderLeftColor = 'var(--accent-red)';
            feedbackError.style.background = 'rgba(239, 68, 68, 0.1)';
        }

        const correctIdx = scriptData[state.level].correctOptionIndex;
        document.getElementById('feedback-correct-content').innerHTML = 
            `<strong>âœ… æœ€ä¼˜æ§åœºç­–ç•¥ï¼š</strong>${allBtns[correctIdx].textContent}`;
        document.getElementById('feedback-principle-content').innerHTML = 
            `<strong>ğŸ“ æ§åœºåŸç†ï¼š</strong>${correctReason}`;
        if (state.chapter === 1 && !isCorrect) {
            state.chapter1Errors.push(state.level);
        }

        document.getElementById('answer-feedback').style.display = 'flex';
        scrollToTop();
        // å¯åŠ¨10ç§’å€’è®¡æ—¶
        startFeedbackTimer();
    }

    // å€’è®¡æ—¶é€»è¾‘
    function startFeedbackTimer() {
        const nextBtn = document.getElementById('btn-next-level');
        let timeLeft = 10;
        
        nextBtn.disabled = true;
        nextBtn.innerHTML = `<i class="fas fa-hourglass-half"></i> ç­–ç•¥æ€è€ƒä¸­ (${timeLeft}s)...`;

        if (state.timerInterval) clearInterval(state.timerInterval);
        state.timerInterval = setInterval(() => {
            timeLeft--;
            if (timeLeft > 0) {
                nextBtn.innerHTML = `<i class="fas fa-hourglass-half"></i> ç­–ç•¥æ€è€ƒä¸­ (${timeLeft}s)...`;
            } else {
                clearInterval(state.timerInterval);
                
                nextBtn.disabled = false;
                nextBtn.innerHTML = `<i class="fas fa-arrow-right"></i> è¿›å…¥ä¸‹ä¸€å…³`;
            }
        }, 1000);
    }

    function closeFeedbackAndNext() {
        if (state.timerInterval) clearInterval(state.timerInterval);
        document.getElementById('answer-feedback').style.display = 'none';
        goToNextLevel();
    }

    // æ›´æ–°çŠ¶æ€å€¼ï¼ˆä¿ç•™æ¸¸æˆè¿‡ç¨‹ä¸­çš„åŠ¨æ€å˜åŒ–ï¼Œä½†æœ€ç»ˆç»“æœä¼šé‡ç®—ï¼‰
    function updateStats(optType) {
        let respectDelta = 0;
        let controlDelta = 0;

        switch(optType) {
            case 'good':
                respectDelta = 20;
                controlDelta = 15;
                break;
            case 'neutral':
                respectDelta = 5;
                controlDelta = -5;
                break;
            case 'bad':
                respectDelta = -25;
                controlDelta = -20;
                break;
        }

        state.respect = Math.max(0, Math.min(100, state.respect + respectDelta));
        state.control = Math.max(0, Math.min(100, state.control + controlDelta));

        document.getElementById('val-respect').textContent = `${state.respect}%`;
        document.getElementById('bar-respect').style.width = `${state.respect}%`;
        
        document.getElementById('val-control').textContent = `${state.control}%`;
        document.getElementById('bar-control').style.width = `${state.control}%`;
    }

    function goToNextLevel() {
        const nextLevel = state.level + 1;
        if (state.level === 3) {
            if (state.chapter1Errors.length === 0) {
                document.getElementById('game-interface').style.display = 'none';
                document.getElementById('chapter-transition').style.display = 'flex';
                state.chapter = 2;
                scrollToTop();
            } else {
                document.getElementById('game-interface').style.display = 'none';
                showChapter1Summary();
            }
            return;
        }

        if (state.level === 7) {
            showFinalSummary();
            return;
        }

        if (scriptData[nextLevel]) {
            loadLevel(nextLevel);
        }
    }

    // æ˜¾ç¤ºæœ€ç»ˆæ€»ç»“å¼¹çª—
    function showFinalSummary() {
        const isAllCorrect = state.allCorrect.length === 7 && state.allCorrect.every(v => v === true);
        const correctCount = state.allCorrect.filter(v => v).length;
        
        // æ ¸å¿ƒä¿®å¤ï¼šæ ¹æ®æ­£ç¡®é¢˜ç›®æ•°é‡é‡æ–°è®¡ç®—æœ€ç»ˆç™¾åˆ†æ¯”ï¼Œç¡®ä¿é€»è¾‘è‡ªæ´½
        // 7é¢˜å…¨å¯¹=100%ï¼Œé”™ä¸€é¢˜æ‰£é™¤ç›¸åº”æ¯”ä¾‹
        const calculatedScore = Math.floor((correctCount / 7) * 100);
        const finalRank = document.getElementById('final-rank');
        const finalDesc = document.getElementById('final-desc');
        const finalErrorSection = document.getElementById('final-error-section');
        const finalErrorList = document.getElementById('final-error-list');
        const finalCorrectCount = document.getElementById('final-correct-count');
        const finalRespect = document.getElementById('final-respect');
        const finalControl = document.getElementById('final-control');

        // å¡«å……æ•°æ®
        finalCorrectCount.textContent = correctCount;
        // ä½¿ç”¨é‡ç®—åçš„é€»è¾‘å€¼ï¼Œè€Œéè¿‡ç¨‹å€¼
        finalRespect.textContent = `${calculatedScore}%`;
        finalControl.textContent = `${calculatedScore}%`;
        if (isAllCorrect) {
            finalRank.className = 'final-title success-title';
            finalRank.textContent = 'æ§åœºå®—å¸ˆ';
            finalDesc.textContent = 'ä½ å®Œç¾æŒæ¡äº†è¯¾å ‚æ§åœºçš„æ ¸å¿ƒé€»è¾‘ï¼Œåœ¨7å¤§å®æˆ˜åœºæ™¯ä¸­å…¨éƒ¨é€‰æ‹©äº†æœ€ä¼˜ç­–ç•¥ï¼ŒçœŸæ­£åšåˆ°äº†â€œè®©å­¦ç”Ÿè¢«å°Šé‡ï¼Œè®©è¯¾å ‚è¢«æŒæ§â€ï¼';
            document.getElementById('final-card').className = 'end-card success-card';
            finalErrorSection.style.display = 'none';
        } else {
            finalRank.className = 'final-title fail-title';
            finalRank.textContent = 'æ§åœºæ–°æ‰‹';
            finalDesc.textContent = 'ä½ å°šæœªå®Œå…¨æŒæ¡è¯¾å ‚æ§åœºçš„æ ¸å¿ƒç­–ç•¥ï¼Œåœ¨éƒ¨åˆ†åœºæ™¯ä¸­è¸©å…¥äº†â€œå¯¹æŠ—ã€é€€è®©ã€æƒ…ç»ªåŒ–â€çš„ç¦åŒºã€‚éœ€é‡æ–°å¤ç›˜é”™è¯¯åœºæ™¯ï¼Œæ‰“ç£¨æ§åœºæŠ€å·§ï¼';
            document.getElementById('final-card').className = 'end-card fail-card';
            finalErrorSection.style.display = 'block';
            finalErrorList.innerHTML = '';
            state.allCorrect.forEach((isCorrect, idx) => {
                if (!isCorrect) {
                    const level = idx + 1;
                    finalErrorList.innerHTML += `<li>ç¬¬${level}å…³ï¼š${scriptData[level].title} - é€‰æ‹©äº†éæœ€ä¼˜ç­–ç•¥</li>`;
                }
            });
        }

        document.getElementById('game-interface').style.display = 'none';
        document.getElementById('final-summary').style.display = 'flex';
        scrollToTop();
    }

    function restartGame() {
        state = { 
            level: 1, 
            respect: 50, 
            control: 50, 
            chapter: 1,
            chapter1Errors: [],
            allCorrect: [],
  
            timerInterval: null
        };
        document.getElementById('val-respect').textContent = '50%';
        document.getElementById('bar-respect').style.width = '50%';
        document.getElementById('val-control').textContent = '50%';
        document.getElementById('bar-control').style.width = '50%';
        
        document.getElementById('final-summary').style.display = 'none';
        document.getElementById('game-interface').style.display = 'flex';
        document.getElementById('chapter-banner').style.display = 'block';
        loadLevel(1);
        scrollToTop();
    }

    function hideChapterTransition() {
        document.getElementById('chapter-transition').style.display = 'none';
        document.getElementById('game-interface').style.display = 'flex';
        loadLevel(4);
    }

    function showChapter1Summary() {
        const errorDetails = document.getElementById('error-details');
        errorDetails.innerHTML = `<h4>âŒ é”™è¯¯å…³å¡è¯¦æƒ…</h4><ul>`;
        
        const uniqueErrors = [...new Set(state.chapter1Errors)];
        uniqueErrors.forEach(level => {
            errorDetails.innerHTML += `<li>ç¬¬${level}å…³ï¼š${scriptData[level].title} - é€‰æ‹©äº†éæœ€ä¼˜ç­–ç•¥</li>`;
        });
        errorDetails.innerHTML += `</ul>`;

        document.getElementById('chapter1-summary').style.display = 'flex';
        scrollToTop();
    }

    function retryChapter1() {
        state.chapter1Errors = [];
        state.respect = 50;
        state.control = 50;
        // æ¸…é™¤å‰3å…³çš„ç­”é¢˜è®°å½•ï¼Œä¿ç•™åç»­ï¼ˆå¦‚æœæœ‰ï¼‰
        state.allCorrect = state.allCorrect.slice(3);
        document.getElementById('val-respect').textContent = '50%';
        document.getElementById('bar-respect').style.width = '50%';
        document.getElementById('val-control').textContent = '50%';
        document.getElementById('bar-control').style.width = '50%';

        document.getElementById('chapter1-summary').style.display = 'none';
        document.getElementById('game-interface').style.display = 'flex';
        loadLevel(1);
        scrollToTop();
    }
</script>
</body>
</html>